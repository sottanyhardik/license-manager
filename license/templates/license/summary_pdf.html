{% extends "pdf_base.html" %}
{% load mathfilters %}

{% block extra_style %}

    <style type="text/css">
        @page {
            size: A4;
            margin: 1cm;
        }


        .table th,
        .table td {
            padding-top: 2px;
            vertical-align: top;
            border: 1px solid #000;
            text-align: center;
        }

        .table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid #000;
        }

        .table tbody + tbody {
            border-top: 2px solid #000;
        }

        .table .table {
            background-color: #fff;
        }

        .list-group p {
            width: 100%;
            height: 18px;
            line-height: 20px;
            list-style: none;
            font-size: 1.1em;
        }
    </style>
{% endblock %}

{% block content %}
    <table class="table table-bordered table-striped tbordered">
        <thead>
        <th><h3>License Number</h3></th>
        <th><h3>License Date</h3></th>
        <th><h3>License Expiry</h3></th>
        <th><h3>File Number</h3></th>
        </thead>
        <tbody>
        <tr>
            <td>
                {{ object.license_number }}
            </td>
            <td>
                {{ object.license_date }}
            </td>
            <td>
                <p>{{ object.license_expiry_date }}</p>
            </td>
            <td>
                <p>{{ object.exporter }}</p>
            </td>
        </tr>
        </tbody>
    </table>
    <br>
    <table class="table table-bordered table-striped tbordered">
        <thead>
        <th>Total CIF $</th>
        <th>Total Debit $</th>
        <th>Balance CIF $</th>
        </thead>
        <tbody>
        {% for export_item in object.export_license.all %}
            <tr>
                <td>{{ export_item.cif_fc|floatformat:2 }}</td>
                <td>{{ total_debits|floatformat:2 }}</td>
                <td>{{ export_item.balance_cif_fc|floatformat:2 }}</td>
            </tr>
        {% endfor %}

        </tbody>
    </table>
    {% for import_item in item_list %}
        <table class="table table-bordered table-striped tbordered" style="margin-top: 5px">
            {% if not 'Milk' in import_item.name %}
                <thead>
                <th colspan="1">Type</th>
                <th colspan="1">Quantity</th>
                <th colspan="1">Unit Price</th>
                <th colspan="1">CIF FC</th>
                <th colspan="2">Company</th>
                </thead>
                <tbody>
                <tr>
                    <td colspan="1">Opening</td>
                    <td colspan="1" style="border: 1px solid">
                        <b>{{ import_item.opening_balance|floatformat:2 }}</b></td>
                    <td colspan="1" style="border: 1px solid;color: red;background-color: yellow;">
                        <b>{{ import_item.hs_code }}</b></td>
                    <td colspan="3" style="color: red;background-color: yellow;"><b>{{ import_item.name|title }}</b>
                    </td>

                </tr>
                </tbody>
            {% else %}
                <thead>
                <th colspan="1">Type</th>
                <th colspan="1">Quantity</th>
                <th colspan="1">HS Code</th>
                <th colspan="5">Item</th>
                </thead>
                <tbody>
                <tr>
                    <td colspan="1">Opening</td>
                    <td colspan="1" style="border: 1px solid">
                        <b>{{ import_item.opening_balance|floatformat:2 }}</b></td>
                    <td colspan="1" style="border: 1px solid;color: red;background-color: yellow;">
                        <b>{{ import_item.hs_code }}</b></td>
                    <td colspan="5" style="color: red;background-color: yellow;"><b>{{ import_item.name|title }}</b>
                    </td>
                </tr>
                </tbody>

            {% endif %}
            {% for item in import_item.debiting %}
                {% for data in item.data_list %}
                    <tr style="border-bottom: 1px solid #000">
                        <td colspan="1" style="color: red;">
                            Debited
                        </td>
                        <td colspan="1">
                            {{ data.qty|floatformat:2 }}
                        </td>
                        <td colspan="1">
                            {{ data.cif_fc|div:data.qty|floatformat:2 }}
                        </td>
                        <td colspan="1">
                            {{ data.cif_fc|floatformat:2 }}
                        </td>
                        <td colspan="2">{{ item.company|title }}</td>
                    </tr>

                {% endfor %}

                <tr style="border-bottom: 1px solid #000;background-color: lightgreen;">
                    <td colspan="1">
                        Total
                    </td>
                    <td colspan="1">
                        {{ item.sum_total_qty|floatformat:2 }}
                    </td>
                    <td colspan="1">
                        {{ item.unit_price|floatformat:2 }}
                    </td>
                    <td colspan="1">
                        {{ item.sum_total_cif_fc|floatformat:2 }}
                    </td>
                    <td colspan="2">{{ item.company|title }}</td>
                </tr>
            {% endfor %}
            {% for item in import_item.allotment %}
                {% for data in item.data_list %}
                    <tr style="border-bottom: 1px solid #000">
                        <td colspan="1" style="color: red;">
                            Alloted
                        </td>
                        <td colspan="1">
                            {{ data.qty|floatformat:2 }}
                        </td>
                        <td colspan="1">
                            {{ data.cif_fc|div:data.qty|floatformat:2 }}
                        </td>
                        <td colspan="1">
                            {{ data.cif_fc|floatformat:2 }}
                        </td>
                        <td colspan="2">{{ item.company|title }}</td>
                    </tr>

                {% endfor %}


                <tr style="border-bottom: 1px solid #000;background-color: yellow;">
                    <td colspan="1">
                        <b>Total</b>
                    </td>
                    <td colspan="1">
                        <b>{{ item.sum_total_qty|floatformat:2 }}</b>
                    </td>
                    <td colspan="1">
                        <b>{{ item.unit_price|floatformat:2 }}</b>
                    </td>
                    <td colspan="1">
                        <b>{{ item.sum_total_cif_fc|floatformat:2 }}</b>
                    </td>
                    <td colspan="2">
                        <b>{{ item.company|title }}</b>
                    </td>
                </tr>
            {% endfor %}
            {% if not 'Milk' in import_item.name %}
                <tr>
                    <td style="width: 10%; border: 1px solid">Total Debits</td>
                    <td style="width: 10%; border: 1px solid">
                        {% if import_item.total_debited_qty %}
                            <b>{{ import_item.total_debited_qty|floatformat:2 }}</b>
                        {% else %}
                            <b>0.00</b>
                        {% endif %}
                    </td>
                    <td>{{ import_item.unit_price|floatformat:2 }}</td>
                    <td style="width: 10%; border: 1px solid">
                        {% if import_item.sum_total_cif_fc %}
                            <b>{{ import_item.sum_total_cif_fc|floatformat:2 }}</b>
                        {% else %}
                            <b>0.00</b>
                        {% endif %}
                    </td>
                    <td colspan="2"></td>
                </tr>

                <tr>
                    <td style="width: 10%; border: 1px solid">Final Balance</td>
                    <td style="width: 10%; border: 1px solid">
                        <b>{{ import_item.balance_qty|floatformat:2 }}</b></td>
                    <td colspan="4"></td>
                </tr>
            {% endif %}
            </tfoot>
        </table>
    {% endfor %}

{% endblock %}